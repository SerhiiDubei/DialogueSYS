# üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ –¥—ñ–∞–ª–æ–≥—ñ–≤ –∑ –ø—Ä–æ–≥—Ä–µ—Å–æ–º

## üéØ –©–æ –ø—Ä–∞—Ü—é—î

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–π–¥–µ–Ω–∏—Ö –¥—ñ–∞–ª–æ–≥—ñ–≤**
- –í—ñ–¥–º—ñ—á–∞—î –∑ –∫–∏–º –ø–æ–≥–æ–≤–æ—Ä–∏–≤ –≥—Ä–∞–≤–µ—Ü—å
- –ü–æ–∫–∞–∑—É—î "(–í–ñ–ï –ì–û–í–û–†–ò–õ–ò)" –¥–ª—è –ø—Ä–æ–π–¥–µ–Ω–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤
- –•–æ–≤–∞—î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ –æ–ø—Ü—ñ—ó (–∞ –Ω–µ –ø–æ–∫–∞–∑—É—î —Å—ñ—Ä–∏–º–∏)
- –õ—ñ—á–∏–ª—å–Ω–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—É (X/4)
- –ö–Ω–æ–ø–∫–∞ "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏—Å—å –≤ –±–∞—Ä" –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è —Ä–æ–∑–º–æ–≤–∏ –∑ —É—Å—ñ–º–∞

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### 1. SaveSystem (Autoload)
**–§–∞–π–ª:** `scripts/save_system.gd`

```gdscript
class_name SaveSystem
extends Node

var completed_dialogues: Array[String] = []  # –°–ø–∏—Å–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö –¥—ñ–∞–ª–æ–≥—ñ–≤
var talked_characters: Array[String] = []    # –°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤ –∑ —è–∫–∏–º–∏ –≥–æ–≤–æ—Ä–∏–ª–∏

# –û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:
func mark_character_talked(character_id: String)  # –í—ñ–¥–º—ñ—Ç–∏—Ç–∏ —Ä–æ–∑–º–æ–≤—É
func has_talked_to(character_id: String) -> bool  # –ß–∏ –≥–æ–≤–æ—Ä–∏–ª–∏ –∑ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º?
func all_characters_completed() -> bool           # –ß–∏ –≤—Å—ñ –ø—Ä–æ–π–¥–µ–Ω—ñ?
func get_completed_characters_count() -> int      # –°–∫—ñ–ª—å–∫–∏ –ø—Ä–æ–π–¥–µ–Ω–æ?
func reset_progress()                             # –°–∫–∏–Ω—É—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å
```

**–í–∞–∂–ª–∏–≤–æ:** 
- SaveSystem –¥–æ–¥–∞–Ω–æ —è–∫ **autoload** –≤ `project.godot`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î –≤ `user://save_game.json`

### 2. GameState
**–§–∞–π–ª:** `scripts/game_state.gd`

```gdscript
extends Node

# –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –≥—Ä–∞–≤—Ü—è
var p_alcohol: int = 0
var p_straight: int = 0
var p_charm: int = 0
var p_patience: int = 0

# –ó–≥–æ–¥–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤
var agreed_alex: bool = false
var agreed_bohdan: bool = false
var agreed_dana: bool = false
var agreed_ira: bool = false

# –í–ê–ñ–õ–ò–í–û: –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ SaveSystem
var save_system: SaveSystem

# –¢–∏–º—á–∞—Å–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –≤–∏–≤–æ–¥—É (–±–æ {} –Ω–µ –ø—Ä–∞—Ü—é—î)
var p_completed_count: int = 0
var p_agreed_total: int = 0

func _ready():
    save_system = SaveSystem.new()
    save_system.name = "SaveSystem"
    add_child(save_system)
```

**–í–∞–∂–ª–∏–≤–æ:**
- GameState —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è **–¥–∏–Ω–∞–º—ñ—á–Ω–æ** –≤ `dialogue_map.gd`
- `save_system` —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –≤ `_ready()`

### 3. Dialogue Manager Integration
**–§–∞–π–ª:** `dialogue/demo.dialogue`

#### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –≤—ñ–¥–º—ñ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:

```dialogue
~ talk_alex

do game_state.save_system.mark_character_talked("alex")  # –ù–ê –ü–û–ß–ê–¢–ö–£!

Alex: –ô–æ, –±—Ä–∞—Ç–∞–Ω! –Ø–∫ —Å–ø—Ä–∞–≤–∏?
...
```

**–ö–†–ò–¢–ò–ß–ù–û:** –í–∏–∫–ª–∏–∫–∞—Ç–∏ `mark_character_talked()` **–ù–ê –ü–û–ß–ê–¢–ö–£** –¥—ñ–∞–ª–æ–≥—É, —â–æ–± –≤—ñ–Ω —Å–ø—Ä–∞—Ü—é–≤–∞–≤ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤–∏–±–æ—Ä—É –≥—Ä–∞–≤—Ü—è!

#### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è —É–º–æ–≤–Ω–∏—Ö –æ–ø—Ü—ñ–π:

```dialogue
~ hub_options

- –ü–æ–≥–æ–≤–æ—Ä–∏—Ç–∏ –∑ –ê–ª–µ–∫—Å–æ–º [if !game_state.save_system.has_talked_to("alex")]
    => talk_alex
- ‚úÖ –ê–ª–µ–∫—Å (–≤–∂–µ –≥–æ–≤–æ—Ä–∏–ª–∏) [if game_state.save_system.has_talked_to("alex")]
    NPC: –¢–∏ –≤–∂–µ –≥–æ–≤–æ—Ä–∏–≤ –∑ –ê–ª–µ–∫—Å–æ–º.
    => hub_options
```

**–í–ê–ñ–õ–ò–í–û:** 
- `[if condition]` **–ø—ñ—Å–ª—è** —Ç–µ–∫—Å—Ç—É –æ–ø—Ü—ñ—ó
- **–ù–ï** `if condition` **–ø–µ—Ä–µ–¥** –æ–ø—Ü—ñ—î—é (—Ü–µ –Ω–µ —Ö–æ–≤–∞—î, –∞ –≤–∏–º–∏–∫–∞—î)

#### ‚úÖ –Ü–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è –∑–Ω–∞—á–µ–Ω—å:

```dialogue
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–Ω–µ –ø—Ä–∞—Ü—é—î):
NPC: –ü—Ä–æ–π–¥–µ–Ω–æ: {game_state.save_system.get_completed_characters_count()}/4

# –ü–†–ê–í–ò–õ–¨–ù–û:
set game_state.p_completed_count = game_state.save_system.get_completed_characters_count()
NPC: –ü—Ä–æ–π–¥–µ–Ω–æ: [[game_state.p_completed_count]]/4
```

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**
- `[[variable]]` ‚Äî —ñ–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è –∑–º—ñ–Ω–Ω–æ—ó
- `{expression}` ‚Äî **–ù–ï –ü–†–ê–¶–Æ–Ñ** –¥–ª—è –≤–∏—Ä–∞–∑—ñ–≤ –∑ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏

### 4. Custom Balloon (UI)
**–§–∞–π–ª:** `ui/balloon.tscn`

**–ö–†–ò–¢–ò–ß–ù–ï –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**

```gdscript
[node name="ResponsesMenu" ...]
hide_failed_responses = true  # –¶–ï –•–û–í–ê–Ñ –ù–ï–î–û–°–¢–£–ü–ù–Ü –û–ü–¶–Ü–á!
```

**–ë–µ–∑ —Ü—å–æ–≥–æ:**
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ñ –æ–ø—Ü—ñ—ó –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è **—Å—ñ—Ä–∏–º–∏** (disabled)
- –ó —Ü–∏–º: –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ –æ–ø—Ü—ñ—ó **–•–û–í–ê–Æ–¢–¨–°–Ø** –ø–æ–≤–Ω—ñ—Å—Ç—é

### 5. Dialogue Map
**–§–∞–π–ª:** `scenes/dialogue_map.gd`

```gdscript
func _ready():
    # –°—Ç–≤–æ—Ä—é—î–º–æ GameState
    game_state = preload("res://scripts/game_state.gd").new()
    game_state.name = "game_state"
    add_child(game_state)
    
    # –í–ê–ñ–õ–ò–í–û: –ß–µ–∫–∞—î–º–æ –ø–æ–∫–∏ _ready() –≤–∏–∫–ª–∏—á–µ—Ç—å—Å—è –¥–ª—è game_state
    await get_tree().process_frame
    
    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ save_system —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞–≤—Å—è
    if game_state.save_system == null:
        push_error("SaveSystem –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞–≤—Å—è!")
```

**–í–ê–ñ–õ–ò–í–û:** `await get_tree().process_frame` —â–æ–± `save_system` –≤—Å—Ç–∏–≥ —Å—Ç–≤–æ—Ä–∏—Ç–∏—Å—å!

## üé® –ö–æ–ª—å–æ—Ä–æ–≤–∞ —Å—Ö–µ–º–∞ –¥—ñ–∞–ª–æ–≥—ñ–≤

**–§–∞–π–ª:** `ui/balloon.gd`

```gdscript
enum DialogueType {
    MAIN_MENU,           # –°–∏–Ω—ñ–π
    CHARACTER_SELECTION, # –ó–µ–ª–µ–Ω–∏–π
    DIALOGUE             # –ß–µ—Ä–≤–æ–Ω–∏–π
}
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º—ñ–Ω—è—î—Ç—å—Å—è** —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª `DialogueManager.passed_title`.

## ‚ö†Ô∏è –ü–æ—à–∏—Ä–µ–Ω—ñ –ø–æ–º–∏–ª–∫–∏ —ñ —Ä—ñ—à–µ–Ω–Ω—è

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û–ø—Ü—ñ—ó –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è —Å—ñ—Ä–∏–º–∏, –∞ –Ω–µ —Ö–æ–≤–∞—é—Ç—å—Å—è
**–†—ñ—à–µ–Ω–Ω—è:** –î–æ–¥–∞—Ç–∏ `hide_failed_responses = true` –≤ `ResponsesMenu`

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `mark_character_talked()` –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
**–†—ñ—à–µ–Ω–Ω—è:** 
1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è **–ù–ê –ü–û–ß–ê–¢–ö–£** –¥—ñ–∞–ª–æ–≥—É
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ `game_state.save_system` –Ω–µ `null`
3. –î–æ–¥–∞—Ç–∏ `await get_tree().process_frame` –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è GameState

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –Ü–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è –ø–æ–∫–∞–∑—É—î –∫–æ–¥ –∑–∞–º—ñ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è
**–†—ñ—à–µ–Ω–Ω—è:** 
1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `[[variable]]` –∑–∞–º—ñ—Å—Ç—å `{expression}`
2. –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü—ñ—ó –≤ —Ç–∏–º—á–∞—Å–æ–≤—É –∑–º—ñ–Ω–Ω—É:
```dialogue
set game_state.p_count = game_state.get_count()
NPC: –†–µ–∑—É–ª—å—Ç–∞—Ç: [[game_state.p_count]]
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `if/else` –¥–ª—è –æ–ø—Ü—ñ–π –Ω–µ –ø—Ä–∞—Ü—é—î
**–†—ñ—à–µ–Ω–Ω—è:** 
- **–ù–ï** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `if/else` **–ø–µ—Ä–µ–¥** –æ–ø—Ü—ñ—è–º–∏
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `[if condition]` **–ø—ñ—Å–ª—è** —Ç–µ–∫—Å—Ç—É –æ–ø—Ü—ñ—ó
- Dialogue Manager –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –¥–∏–Ω–∞–º—ñ—á–Ω–µ —Ö–æ–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `if` –±–ª–æ–∫–∏

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –í—Å—ñ –æ–ø—Ü—ñ—ó –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ
**–†—ñ—à–µ–Ω–Ω—è:** –¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! `hide_failed_responses = true` –ø—Ä–∏—Ö–æ–≤–∞—î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ save_system.gd        # Autoload –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É
‚îÇ   ‚îî‚îÄ‚îÄ game_state.gd         # –°—Ç–∞–Ω –≥—Ä–∏ (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏, –∑–≥–æ–¥–∞)
‚îú‚îÄ‚îÄ dialogue/
‚îÇ   ‚îî‚îÄ‚îÄ demo.dialogue         # –ì–æ–ª–æ–≤–Ω–∏–π –¥—ñ–∞–ª–æ–≥
‚îú‚îÄ‚îÄ scenes/
‚îÇ   ‚îú‚îÄ‚îÄ dialogue_map.tscn     # –ö–∞—Ä—Ç–∞ –¥—ñ–∞–ª–æ–≥—ñ–≤ (–≥–æ–ª–æ–≤–Ω–∞ —Å—Ü–µ–Ω–∞)
‚îÇ   ‚îî‚îÄ‚îÄ dialogue_map.gd       # –õ–æ–≥—ñ–∫–∞ –∫–∞—Ä—Ç–∏
‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îú‚îÄ‚îÄ balloon.tscn          # –ö–∞—Å—Ç–æ–º–Ω–∏–π balloon (hide_failed_responses = true)
‚îÇ   ‚îî‚îÄ‚îÄ balloon.gd            # –õ–æ–≥—ñ–∫–∞ balloon (–∫–æ–ª—å–æ—Ä–∏, —Å—Ç–∏–ª—ñ)
‚îî‚îÄ‚îÄ project.godot             # SaveSystem –≤ autoload
```

## üîÑ –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –¥—ñ–∞–ª–æ–≥—É

1. **–ó–∞–ø—É—Å–∫ –≥—Ä–∏** ‚Üí `dialogue_map.gd._ready()`
2. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è GameState** ‚Üí `game_state._ready()` ‚Üí —Å—Ç–≤–æ—Ä—é—î SaveSystem
3. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É** ‚Üí `SaveSystem.load_game_data()`
4. **–í–∏–±—ñ—Ä –¥—ñ–∞–ª–æ–≥—É** ‚Üí `start_dialogue(title)`
5. **–ü–æ—á–∞—Ç–æ–∫ —Ä–æ–∑–º–æ–≤–∏** ‚Üí `do game_state.save_system.mark_character_talked()`
6. **–ü–æ–∫–∞–∑ –æ–ø—Ü—ñ–π** ‚Üí `hide_failed_responses` —Ö–æ–≤–∞—î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ
7. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—É** ‚Üí `all_characters_completed()`
8. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è** ‚Üí `SaveSystem.save_game_data()`

## üéØ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –Ω–æ–≤–∏—Ö –¥—ñ–∞–ª–æ–≥—ñ–≤

- [ ] –î–æ–¥–∞—Ç–∏ `do game_state.save_system.mark_character_talked("id")` –Ω–∞ –ø–æ—á–∞—Ç–∫—É
- [ ] –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `[if condition]` **–ø—ñ—Å–ª—è** —Ç–µ–∫—Å—Ç—É –æ–ø—Ü—ñ—ó
- [ ] –î–ª—è –≤–∏–≤–æ–¥—É —á–∏—Å–µ–ª: –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ —Ç–∏–º—á–∞—Å–æ–≤—É –∑–º—ñ–Ω–Ω—É, –ø–æ—Ç—ñ–º `[[variable]]`
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ `hide_failed_responses = true` –≤ balloon
- [ ] –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è/–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

## üìù –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤–Ω–æ–≥–æ –¥—ñ–∞–ª–æ–≥—É

```dialogue
~ talk_new_character

do game_state.save_system.mark_character_talked("new_character")

NewChar: –ü—Ä–∏–≤—ñ—Ç!

if game_state.p_charm >= 50
    NewChar: –¢–∏ —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω–∏–π!
    set game_state.agreed_new = true
else
    NewChar: –ú–æ–∂–µ —ñ–Ω—à–∏–º —Ä–∞–∑–æ–º.

=> hub_options

~ hub_options

- –ü–æ–≥–æ–≤–æ—Ä–∏—Ç–∏ –∑ –Ω–æ–≤–∏–º [if !game_state.save_system.has_talked_to("new_character")]
    => talk_new_character
- ‚úÖ –ù–æ–≤–∏–π (–≤–∂–µ –≥–æ–≤–æ—Ä–∏–ª–∏) [if game_state.save_system.has_talked_to("new_character")]
    NPC: –¢–∏ –≤–∂–µ –≥–æ–≤–æ—Ä–∏–≤.
    => hub_options
```

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** 2026-01-17  
**–í–µ—Ä—Å—ñ—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–†–ê–¶–Æ–Ñ
